+++
title = "ç³»ç»Ÿé…ç½®å·¥å…·"
date = "2025-10-28"
description = "å®‰è£…LFSç³»ç»Ÿé…ç½®å’Œç®¡ç†å·¥å…·"
weight 5
+++

# ç³»ç»Ÿé…ç½®å·¥å…·

ç³»ç»Ÿé…ç½®å·¥å…·æ˜¯Linuxç³»ç»Ÿç®¡ç†å’Œé…ç½®çš„æ ¸å¿ƒå·¥å…·é›†ï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ—¥å¿—ã€æ—¶é’Ÿç®¡ç†ã€ç»ˆç«¯å·¥å…·ç­‰ã€‚æœ¬ç« å°†è¯¦ç»†ä»‹ç»è¿™äº›å·¥å…·çš„ç¼–è¯‘å’Œå®‰è£…ã€‚

## ğŸ¯ å·¥å…·æ¦‚è¿°

### å·¥å…·åˆ†ç±»

ç³»ç»Ÿé…ç½®å·¥å…·ä¸»è¦åŒ…æ‹¬ï¼š

- **ç³»ç»Ÿæ—¥å¿—å·¥å…·**ï¼šsysklogd, syslog-ng
- **æ—¶é’Ÿç®¡ç†å·¥å…·**ï¼šutil-linux (hwclock)
- **ç»ˆç«¯å·¥å…·**ï¼šncurses, readline
- **æ–‡æ¡£å·¥å…·**ï¼šman-db, texinfo
- **å…¶ä»–ç³»ç»Ÿå·¥å…·**ï¼škbd, console-data

## ğŸ“ Sysklogdå·¥å…·

### ç¼–è¯‘Sysklogd
```bash
# åˆ‡æ¢åˆ°lfsç”¨æˆ·
su - lfs

# åˆ›å»ºæ„å»ºç›®å½•
mkdir -pv $LFS/sources/system_tools
cd $LFS/sources/system_tools

# è§£å‹Sysklogdæºç 
tar -xf $LFS/sources/sysklogd-1.5.1.tar.gz
cd sysklogd-1.5.1

# é…ç½®Sysklogd
sed -i '/Error loading kernel symbols/{n;n;d}' ksym_mod.c
sed -i 's/union wait/int/' syslogd.c

# ç¼–è¯‘
make $LFS_MAKEFLAGS

# å®‰è£…
make BINDIR=/sbin install

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > /etc/syslog.conf << "EOF"
# Begin /etc/syslog.conf

auth,authpriv.* -/var/log/auth.log
*.*;auth,authpriv.none -/var/log/sys.log
daemon.* -/var/log/daemon.log
kern.* -/var/log/kern.log
mail.* -/var/log/mail.log
user.* -/var/log/user.log
*.emerg *

# End /etc/syslog.conf
EOF
```

## âŒš ç¡¬ä»¶æ—¶é’Ÿå·¥å…·

### é…ç½®Hwclock
```bash
# è¿”å›æºç ç›®å½•
cd $LFS/sources/system_tools

# è§£å‹Util-linuxæºç ï¼ˆå¦‚æœè¿˜æ²¡æœ‰è§£å‹ï¼‰
# tar -xf $LFS/sources/util-linux-2.38.1.tar.xz
# cd util-linux-2.38.1

# å®é™…ä¸Šhwclockå·²ç»åœ¨util-linuxä¸­å®‰è£…äº†
# è¿™é‡Œåªéœ€è¦é…ç½®

# åˆ›å»ºæ—¶é’Ÿé…ç½®æ–‡ä»¶
cat > /etc/adjtime << "EOF"
0.0 0 0.0
0
LOCAL
EOF
```

## ğŸ–¥ï¸ Ncursesåº“

### ç¼–è¯‘Ncurses
```bash
# è¿”å›æºç ç›®å½•
cd $LFS/sources/system_tools

# è§£å‹Ncursesæºç 
tar -xf $LFS/sources/ncurses-6.4.tar.gz
cd ncurses-6.4

# é…ç½®Ncurses
./configure --prefix=/usr \
            --mandir=/usr/share/man \
            --with-shared \
            --without-debug \
            --without-normal \
            --with-cxx-shared \
            --enable-pc-files \
            --enable-widec \
            --with-pkg-config-libdir=/usr/lib/pkgconfig

# ç¼–è¯‘
make $LFS_MAKEFLAGS

# å®‰è£…
make DESTDIR=$LFS install

# ä¿®å¤åº“æ–‡ä»¶
mv -v $LFS/usr/lib/libncursesw.so.6* /usr/lib
ln -sfv ../../lib/$(readlink $LFS/usr/lib/libncursesw.so) /usr/lib/libncursesw.so

# åˆ›å»ºå…¼å®¹æ€§ç¬¦å·é“¾æ¥
for lib in ncurses form panel menu ; do
    rm -vf /usr/lib/lib${lib}.so
    echo "INPUT(-l${lib}w)" > /usr/lib/lib${lib}.so
    ln -sfv ${lib}w.pc /usr/lib/pkgconfig/${lib}.pc
done

# å®‰è£…æ–‡æ¡£
rm -vf /usr/lib/libcursesw.so
echo "INPUT(-lncursesw)" > /usr/lib/libcursesw.so
ln -sfv libncurses.so /usr/lib/libcurses.so

# æ¸…ç†
rm -rf $LFS/usr/share/man
```

## ğŸ“– Readlineåº“

### ç¼–è¯‘Readline
```bash
# è¿”å›æºç ç›®å½•
cd $LFS/sources/system_tools

# è§£å‹Readlineæºç 
tar -xf $LFS/sources/readline-8.2.tar.gz
cd readline-8.2

# é…ç½®Readline
./configure --prefix=/usr \
            --disable-static \
            --with-curses \
            --docdir=/usr/share/doc/readline-8.2

# ç¼–è¯‘
make $LFS_MAKEFLAGS SHLIB_LIBS="-lncursesw"

# å®‰è£…
make SHLIB_LIBS="-lncursesw" install

# å®‰è£…æ–‡æ¡£
install -v -m644 doc/*.{ps,pdf,html,dvi} /usr/share/doc/readline-8.2
```

## ğŸ“š Man-dbå·¥å…·

### ç¼–è¯‘Man-db
```bash
# è¿”å›æºç ç›®å½•
cd $LFS/sources/system_tools

# è§£å‹Man-dbæºç 
tar -xf $LFS/sources/man-db-2.11.2.tar.xz
cd man-db-2.11.2

# é…ç½®Man-db
./configure --prefix=/usr \
            --docdir=/usr/share/doc/man-db-2.11.2 \
            --sysconfdir=/etc \
            --disable-setuid \
            --enable-cache-owner=bin \
            --with-browser=/usr/bin/lynx \
            --with-vgrind=/usr/bin/vgrind \
            --with-grap=/usr/bin/grap \
            --with-systemdtmpfilesdir= \
            --with-systemdsystemunitdir=

# ç¼–è¯‘
make $LFS_MAKEFLAGS

# å®‰è£…
make install

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > /etc/man_db.conf << "EOF"
# Begin /etc/man_db.conf

# Mandb configuration

# Every automatically generated manpage snippet in the man-db configuration
# file must have the same order and information as the one generated by
# mandb. The man-db configuration file is generated by mandb and possibly
# modified by the system administrator.

# The automatically generated manpage snippets are identified by the
# following comment:
# This file was generated by mandb

# The following paths are the defaults for man_db.conf. Uncomment and
# modify as needed.

#MANDATORY_MANPATH /usr/man
#MANDATORY_MANPATH /usr/share/man
#MANDATORY_MANPATH /usr/local/man
#MANDATORY_MANPATH /usr/local/share/man

MANPATH_MAP /bin /usr/share/man
MANPATH_MAP /usr/bin /usr/share/man
MANPATH_MAP /sbin /usr/share/man
MANPATH_MAP /usr/sbin /usr/share/man
MANPATH_MAP /usr/local/bin /usr/local/share/man
MANPATH_MAP /usr/local/sbin /usr/local/share/man
MANPATH_MAP /usr/X11R6/bin /usr/X11R6/share/man

# End /etc/man_db.conf
EOF
```

## âŒ¨ï¸ Kbdå·¥å…·

### ç¼–è¯‘Kbd
```bash
# è¿”å›æºç ç›®å½•
cd $LFS/sources/system_tools

# è§£å‹Kbdæºç 
tar -xf $LFS/sources/kbd-2.5.1.tar.xz
cd kbd-2.5.1

# åº”ç”¨è¡¥ä¸
patch -Np1 -i ../kbd-2.5.1-backspace-1.patch

# é…ç½®Kbd
./configure --prefix=/usr --disable-vlock

# ç¼–è¯‘
make $LFS_MAKEFLAGS

# å®‰è£…
make install

# å®‰è£…æ–‡æ¡£
mkdir -v /usr/share/doc/kbd-2.5.1
cp -R -v docs/doc/* /usr/share/doc/kbd-2.5.1
```

## ğŸ“‹ æ„å»ºè„šæœ¬

### è‡ªåŠ¨åŒ–æ„å»ºè„šæœ¬
```bash
# åˆ›å»ºç³»ç»Ÿå·¥å…·æ„å»ºè„šæœ¬
cat > $LFS/build_system_tools.sh << 'EOF'
#!/bin/bash
# LFSç³»ç»Ÿå·¥å…·æ„å»ºè„šæœ¬

set -e

# å·¥å…·åˆ—è¡¨
tools=(
    "sysklogd-1.5.1:sysklogd"
    "ncurses-6.4:ncurses"
    "readline-8.2:readline"
    "man-db-2.11.2:man-db"
    "kbd-2.5.1:kbd"
)

total_tools=${#tools[@]}
completed=0

for tool_info in "${tools[@]}"; do
    IFS=':' read -r package_name tool_name <<< "$tool_info"

    echo "=== æ„å»º $tool_name ($((completed + 1))/$total_tools) ==="

    # æ£€æŸ¥æºç 
    if [ ! -f "$LFS/sources/$package_name.tar.xz" ] && [ ! -f "$LFS/sources/$package_name.tar.gz" ]; then
        echo "é”™è¯¯: $package_name æºç ä¸å­˜åœ¨"
        exit 1
    fi

    cd $LFS/sources/system_tools

    # è§£å‹æºç 
    if [ -f "$LFS/sources/$package_name.tar.xz" ]; then
        tar -xf "$LFS/sources/$package_name.tar.xz"
    else
        tar -xf "$LFS/sources/$package_name.tar.gz"
    fi

    cd $package_name

    # ç‰¹æ®Šæ„å»ºæµç¨‹
    case $tool_name in
        sysklogd)
            sed -i '/Error loading kernel symbols/{n;n;d}' ksym_mod.c
            sed -i 's/union wait/int/' syslogd.c
            make $LFS_MAKEFLAGS
            make BINDIR=/sbin install
            cat > /etc/syslog.conf << "EOF"
auth,authpriv.* -/var/log/auth.log
*.*;auth,authpriv.none -/var/log/sys.log
daemon.* -/var/log/daemon.log
kern.* -/var/log/kern.log
mail.* -/var/log/mail.log
user.* -/var/log/user.log
*.emerg *
EOF
            ;;

        ncurses)
            ./configure --prefix=/usr \
                        --mandir=/usr/share/man \
                        --with-shared \
                        --without-debug \
                        --without-normal \
                        --with-cxx-shared \
                        --enable-pc-files \
                        --enable-widec \
                        --with-pkg-config-libdir=/usr/lib/pkgconfig
            make $LFS_MAKEFLAGS
            make DESTDIR=$LFS install
            mv -v $LFS/usr/lib/libncursesw.so.6* /usr/lib
            ln -sfv ../../lib/$(readlink $LFS/usr/lib/libncursesw.so) /usr/lib/libncursesw.so
            for lib in ncurses form panel menu ; do
                rm -vf /usr/lib/lib${lib}.so
                echo "INPUT(-l${lib}w)" > /usr/lib/lib${lib}.so
                ln -sfv ${lib}w.pc /usr/lib/pkgconfig/${lib}.pc
            done
            rm -vf /usr/lib/libcursesw.so
            echo "INPUT(-lncursesw)" > /usr/lib/libcursesw.so
            ln -sfv libncurses.so /usr/lib/libcurses.so
            rm -rf $LFS/usr/share/man
            ;;

        readline)
            ./configure --prefix=/usr \
                        --disable-static \
                        --with-curses \
                        --docdir=/usr/share/doc/readline-8.2
            make $LFS_MAKEFLAGS SHLIB_LIBS="-lncursesw"
            make SHLIB_LIBS="-lncursesw" install
            install -v -m644 doc/*.{ps,pdf,html,dvi} /usr/share/doc/readline-8.2
            ;;

        man-db)
            ./configure --prefix=/usr \
                        --docdir=/usr/share/doc/man-db-2.11.2 \
                        --sysconfdir=/etc \
                        --disable-setuid \
                        --enable-cache-owner=bin \
                        --with-browser=/usr/bin/lynx \
                        --with-vgrind=/usr/bin/vgrind \
                        --with-grap=/usr/bin/grap \
                        --with-systemdtmpfilesdir= \
                        --with-systemdsystemunitdir=
            make $LFS_MAKEFLAGS
            make install
            cat > /etc/man_db.conf << "EOF"
MANPATH_MAP /bin /usr/share/man
MANPATH_MAP /usr/bin /usr/share/man
MANPATH_MAP /sbin /usr/share/man
MANPATH_MAP /usr/sbin /usr/share/man
MANPATH_MAP /usr/local/bin /usr/local/share/man
MANPATH_MAP /usr/local/sbin /usr/local/share/man
MANPATH_MAP /usr/X11R6/bin /usr/X11R6/share/man
EOF
            ;;

        kbd)
            patch -Np1 -i ../kbd-2.5.1-backspace-1.patch
            ./configure --prefix=/usr --disable-vlock
            make $LFS_MAKEFLAGS
            make install
            mkdir -v /usr/share/doc/kbd-2.5.1
            cp -R -v docs/doc/* /usr/share/doc/kbd-2.5.1
            ;;
    esac

    # éªŒè¯å®‰è£…
    echo "éªŒè¯ $tool_name å®‰è£…..."
    case $tool_name in
        sysklogd)
            [ -x /sbin/syslogd ] && echo "âœ“ sysklogd å®‰è£…æˆåŠŸ" || echo "âœ— sysklogd å®‰è£…å¤±è´¥"
            ;;
        ncurses)
            [ -f /usr/lib/libncursesw.so ] && echo "âœ“ ncurses å®‰è£…æˆåŠŸ" || echo "âœ— ncurses å®‰è£…å¤±è´¥"
            ;;
        readline)
            [ -f /usr/lib/libreadline.so ] && echo "âœ“ readline å®‰è£…æˆåŠŸ" || echo "âœ— readline å®‰è£…å¤±è´¥"
            ;;
        man-db)
            [ -x /usr/bin/man ] && echo "âœ“ man-db å®‰è£…æˆåŠŸ" || echo "âœ— man-db å®‰è£…å¤±è´¥"
            ;;
        kbd)
            [ -x /usr/bin/loadkeys ] && echo "âœ“ kbd å®‰è£…æˆåŠŸ" || echo "âœ— kbd å®‰è£…å¤±è´¥"
            ;;
    esac

    completed=$((completed + 1))
    echo "è¿›åº¦: $completed/$total_tools å®Œæˆ"
    echo ""

    # æ¸…ç†æ„å»ºç›®å½•
    cd $LFS/sources/system_tools
    rm -rf $package_name
done

echo "=== æ‰€æœ‰ç³»ç»Ÿå·¥å…·æ„å»ºå®Œæˆ ==="
EOF

chmod +x $LFS/build_system_tools.sh
```

## ğŸ§ª åŠŸèƒ½éªŒè¯

### å·¥å…·å¯ç”¨æ€§æµ‹è¯•
```bash
# åˆ›å»ºéªŒè¯è„šæœ¬
cat > $LFS/verify_system_tools.sh << 'EOF'
#!/bin/bash
# ç³»ç»Ÿå·¥å…·éªŒè¯è„šæœ¬

echo "=== LFSç³»ç»Ÿå·¥å…·éªŒè¯ ==="

# å®šä¹‰è¦éªŒè¯çš„å·¥å…·
tools=(
    "/sbin/syslogd:sysklogd"
    "/usr/lib/libncursesw.so:ncurses"
    "/usr/lib/libreadline.so:readline"
    "/usr/bin/man:man-db"
    "/usr/bin/loadkeys:kbd"
)

passed=0
total=${#tools[@]}

for tool_info in "${tools[@]}"; do
    IFS=':' read -r tool_path tool_name <<< "$tool_info"

    echo -n "æ£€æŸ¥ $tool_name ($tool_path)... "

    if [ -e "$tool_path" ]; then
        echo "âœ“ å­˜åœ¨"

        # åŸºæœ¬åŠŸèƒ½æµ‹è¯•
        case $tool_name in
            sysklogd)
                $tool_path --version >/dev/null 2>&1 && echo "  ç‰ˆæœ¬æ£€æŸ¥: âœ“" || echo "  ç‰ˆæœ¬æ£€æŸ¥: âœ—"
                ;;
            ncurses)
                # æ£€æŸ¥æ˜¯å¦å¯ä»¥é“¾æ¥
                echo "#include <ncurses.h>" > test_ncurses.c
                echo "int main() { initscr(); endwin(); return 0; }" >> test_ncurses.c
                gcc test_ncurses.c -lncursesw -o test_ncurses >/dev/null 2>&1 && echo "  ç¼–è¯‘æµ‹è¯•: âœ“" || echo "  ç¼–è¯‘æµ‹è¯•: âœ—"
                rm -f test_ncurses.c test_ncurses
                ;;
            readline)
                # æ£€æŸ¥readlineå¤´æ–‡ä»¶
                [ -f /usr/include/readline/readline.h ] && echo "  å¤´æ–‡ä»¶: âœ“" || echo "  å¤´æ–‡ä»¶: âœ—"
                ;;
            man-db)
                man --version >/dev/null 2>&1 && echo "  ç‰ˆæœ¬æ£€æŸ¥: âœ“" || echo "  ç‰ˆæœ¬æ£€æŸ¥: âœ—"
                ;;
            kbd)
                $tool_path --version >/dev/null 2>&1 && echo "  ç‰ˆæœ¬æ£€æŸ¥: âœ“" || echo "  ç‰ˆæœ¬æ£€æŸ¥: âœ—"
                ;;
        esac

        passed=$((passed + 1))
    else
        echo "âœ— ä¸å­˜åœ¨"
    fi
done

echo ""
echo "=== éªŒè¯ç»“æœ ==="
echo "é€šè¿‡: $passed/$total"

if [ $passed -eq $total ]; then
    echo "âœ“ æ‰€æœ‰ç³»ç»Ÿå·¥å…·éƒ½å·²æ­£ç¡®å®‰è£…"
    exit 0
else
    echo "âœ— éƒ¨åˆ†å·¥å…·å®‰è£…å¤±è´¥"
    exit 1
fi
EOF

chmod +x $LFS/verify_system_tools.sh
```

## ğŸš¨ å¸¸è§é—®é¢˜

### Ncursesç¼–è¯‘é—®é¢˜
```bash
# å¦‚æœNcursesç¼–è¯‘å¤±è´¥ï¼š
# 1. æ£€æŸ¥ä¾èµ–
echo "æ£€æŸ¥gccç‰ˆæœ¬..."
gcc --version

# 2. æ£€æŸ¥é…ç½®
echo "æ£€æŸ¥é…ç½®é€‰é¡¹..."
cd ncurses-6.4
./configure --help | grep -A5 -B5 shared

# 3. é‡æ–°é…ç½®
make clean
./configure --prefix=/usr --with-shared --enable-widec
```

### Man-dbé…ç½®é—®é¢˜
```bash
# å¦‚æœman-dbé…ç½®æœ‰é—®é¢˜ï¼š
# 1. æ£€æŸ¥groffæ˜¯å¦å®‰è£…
which groff || echo "groffæœªå®‰è£…"

# 2. æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /etc/man_db.conf

# 3. é‡æ–°ç”Ÿæˆmanæ•°æ®åº“
mandb -c
```

### Kbdå·¥å…·é—®é¢˜
```bash
# å¦‚æœkbdæœ‰é—®é¢˜ï¼š
# 1. æ£€æŸ¥å†…æ ¸å¤´æ–‡ä»¶
ls -la /usr/include/linux/

# 2. æ£€æŸ¥è¡¥ä¸åº”ç”¨
cd kbd-2.5.1
ls -la *.patch 2>/dev/null || echo "è¡¥ä¸æ–‡ä»¶ä¸å­˜åœ¨"

# 3. é‡æ–°åº”ç”¨è¡¥ä¸
patch -Np1 -i ../kbd-2.5.1-backspace-1.patch
```

## ğŸ“Š é…ç½®éªŒè¯

### ç³»ç»Ÿæ—¥å¿—é…ç½®
```bash
# æµ‹è¯•syslogé…ç½®
echo "æµ‹è¯•ç³»ç»Ÿæ—¥å¿—..."

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /etc/syslog.conf

# åˆ›å»ºæµ‹è¯•æ—¥å¿—
logger "LFSç³»ç»Ÿæ—¥å¿—æµ‹è¯•"

# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶
ls -la /var/log/
tail /var/log/sys.log
```

### æ‰‹å†Œé¡µé…ç½®
```bash
# æµ‹è¯•æ‰‹å†Œé¡µ
echo "æµ‹è¯•æ‰‹å†Œé¡µ..."

# æ£€æŸ¥manå‘½ä»¤
man --version

# æµ‹è¯•å…·ä½“æ‰‹å†Œé¡µ
man ls >/dev/null && echo "æ‰‹å†Œé¡µå·¥ä½œæ­£å¸¸" || echo "æ‰‹å†Œé¡µæœ‰é—®é¢˜"

# æ›´æ–°manæ•°æ®åº“
mandb
```

## ğŸ“š ç›¸å…³èµ„æº

- [LFSå®˜æ–¹æ–‡æ¡£ - ç³»ç»Ÿå·¥å…·](http://www.linuxfromscratch.org/lfs/view/stable/chapter06/chapter06.html)
- [Ncursesæ–‡æ¡£](https://invisible-island.net/ncurses/)
- [Readlineæ–‡æ¡£](https://tiswww.case.edu/php/chet/readline/rltop.html)

---

*æœ€è¿‘æ›´æ–°: {{ .Lastmod.Format "2006-01-02" }}*